
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–µ–¥–∞–∫—Ç–æ—Ä –≥–Ω—ë–∑–¥ –ì—É—Å–Ω–µ—Ç–∞</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        :root {
            --goose-yellow: #ffcc00;
            --goose-brown: #8b4513;
            --goose-green: #2e8b57;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }
        
        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border: 2px solid var(--goose-yellow);
            height: fit-content;
        }
        
        .sidebar h2 {
            color: var(--goose-brown);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            background: var(--goose-yellow);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            padding: 12px 15px;
            border-radius: 10px;
            cursor: pointer;
            margin-bottom: 8px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-item:hover {
            background: #fff9e6;
        }
        
        .nav-item.active {
            background: var(--goose-yellow);
            font-weight: bold;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–∞—è –æ–±–ª–∞—Å—Ç—å */
        .main-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            min-height: 80vh;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--goose-yellow);
        }
        
        .page-title {
            color: var(--goose-brown);
            font-size: 24px;
        }
        
        .btn {
            background: var(--goose-yellow);
            color: #333;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #ffd633;
            transform: translateY(-2px);
        }
        
        /* –°–ø–∏—Å–æ–∫ —Å–∞–π—Ç–æ–≤ */
        .sites-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .site-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .site-card:hover {
            border-color: var(--goose-yellow);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .site-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .site-name {
            font-size: 18px;
            font-weight: bold;
            color: var(--goose-brown);
        }
        
        .site-status {
            background: #d4edda;
            color: #155724;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
        }
        
        .site-meta {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
        }
        
        .storage-bar {
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .storage-used {
            height: 100%;
            background: var(--goose-green);
            width: 0%;
            transition: width 0.5s;
        }
        
        /* –†–µ–¥–∞–∫—Ç–æ—Ä */
        .editor-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            height: 70vh;
        }
        
        .code-editor, .preview-frame {
            border: 2px solid #eee;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .editor-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .editor-tabs {
            display: flex;
            gap: 10px;
        }
        
        .editor-tab {
            padding: 8px 15px;
            background: #e9ecef;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        
        .editor-tab.active {
            background: var(--goose-yellow);
        }
        
        textarea.code-input {
            width: 100%;
            height: calc(100% - 60px);
            padding: 20px;
            border: none;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: none;
            outline: none;
        }
        
        .preview-frame {
            background: white;
        }
        
        .preview-frame iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
        
        /* –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä */
        .file-manager {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
        }
        
        .file-tree {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            max-height: 500px;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 10px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 5px;
        }
        
        .file-item:hover {
            background: #e9ecef;
        }
        
        .file-item.active {
            background: var(--goose-yellow);
        }
        
        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
            max-width: 400px;
            border-left: 5px solid var(--goose-yellow);
        }
        
        .notification.show {
            display: block;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                order: 2;
            }
            
            .editor-container {
                grid-template-columns: 1fr;
                height: auto;
            }
            
            .code-editor, .preview-frame {
                height: 400px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- –°–∞–π–¥–±–∞—Ä -->
        <div class="sidebar">
            <h2>ü¶¢ –ì—É—Å–∏–Ω—ã–µ –ì–Ω—ë–∑–¥–∞</h2>
            
            <div class="user-info">
                <div class="user-avatar" id="user-avatar">–ì</div>
                <div>
                    <div id="user-name">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                    <div style="font-size: 12px; color: #666;" id="user-storage">0/50 –ú–ë</div>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item active" data-page="dashboard">
                    üìä –ú–æ–∏ —Å–∞–π—Ç—ã
                </li>
                <li class="nav-item" data-page="create">
                    üÜï –°–æ–∑–¥–∞—Ç—å —Å–∞–π—Ç
                </li>
                <li class="nav-item" data-page="templates">
                    üé® –®–∞–±–ª–æ–Ω—ã
                </li>
                <li class="nav-item" data-page="files">
                    üìÅ –§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä
                </li>
                <li class="nav-item" data-page="settings">
                    ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                </li>
                <li class="nav-item" data-page="help">
                    ‚ùì –ü–æ–º–æ—â—å
                </li>
            </ul>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid #eee;">
                <div style="font-size: 12px; color: #666; margin-bottom: 10px;">
                    üöÄ –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
                </div>
                <button class="btn" style="width: 100%; margin-bottom: 10px;" onclick="createNewSite()">
                    ü¶¢ –ù–æ–≤–æ–µ –≥–Ω–µ–∑–¥–æ
                </button>
                <button class="btn" style="width: 100%; background: #e9ecef;" onclick="openGitHubRepo()">
                    üì¶ –û—Ç–∫—Ä—ã—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
                </button>
            </div>
        </div>
        
        <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="main-content">
            <div class="page-header">
                <h1 class="page-title" id="page-title">–ú–æ–∏ —Å–∞–π—Ç—ã</h1>
                <div id="page-actions"></div>
            </div>
            
            <!-- –î–∞—à–±–æ—Ä–¥ -->
            <div id="page-dashboard" class="page-content">
                <div class="sites-grid" id="sites-list">
                    <!-- –°–∞–π—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
            </div>
            
            <!-- –°–æ–∑–¥–∞–Ω–∏–µ —Å–∞–π—Ç–∞ -->
            <div id="page-create" class="page-content" style="display: none;">
                <div style="max-width: 600px; margin: 0 auto;">
                    <h3 style="margin-bottom: 20px;">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤–æ–µ –≥–Ω–µ–∑–¥–æ</h3>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                        <div style="font-weight: bold; margin-bottom: 10px;">üìù –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
                        <input type="text" id="site-name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞" style="
                            width: 100%;
                            padding: 12px;
                            border: 2px solid #ddd;
                            border-radius: 8px;
                            margin-bottom: 15px;
                            font-size: 16px;
                        ">
                        
                        <textarea id="site-description" placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Å–∞–π—Ç–∞" style="
                            width: 100%;
                            padding: 12px;
                            border: 2px solid #ddd;
                            border-radius: 8px;
                            margin-bottom: 15px;
                            font-size: 16px;
                            min-height: 100px;
                            resize: vertical;
                        "></textarea>
                        
                        <select id="site-template" style="
                            width: 100%;
                            padding: 12px;
                            border: 2px solid #ddd;
                            border-radius: 8px;
                            margin-bottom: 15px;
                            font-size: 16px;
                        ">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —à–∞–±–ª–æ–Ω...</option>
                            <option value="blank">üÜï –ß–∏—Å—Ç—ã–π —à–∞–±–ª–æ–Ω</option>
                            <option value="blog">üìù –ë–ª–æ–≥</option>
                            <option value="portfolio">üé® –ü–æ—Ä—Ç—Ñ–æ–ª–∏–æ</option>
                            <option value="business">üíº –ë–∏–∑–Ω–µ—Å-—Å–∞–π—Ç</option>
                        </select>
                        
                        <select id="site-biom" style="
                            width: 100%;
                            padding: 12px;
                            border: 2px solid #ddd;
                            border-radius: 8px;
                            margin-bottom: 20px;
                            font-size: 16px;
                        ">
                            <option value="swamp">ü¶¢ –ë–æ–ª–æ—Ç–æ (–±–ª–æ–≥–∏, —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è)</option>
                            <option value="tech">üíª –¢–µ—Ö–Ω–æ–±–æ–ª–æ—Ç–æ (—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)</option>
                            <option value="art">üé® –õ—É–≥–∞ –∏—Å–∫—É—Å—Å—Ç–≤–∞ (—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ)</option>
                            <option value="nature">üåø –ü—Ä–∏—Ä–æ–¥–∞ (—ç–∫–æ–ª–æ–≥–∏—è)</option>
                        </select>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn" onclick="createSite()">
                            üöÄ –°–æ–∑–¥–∞—Ç—å —Å–∞–π—Ç
                        </button>
                        <button class="btn" style="background: #e9ecef; color: #666;" onclick="switchPage('dashboard')">
                            ‚Üê –ù–∞–∑–∞–¥
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- –†–µ–¥–∞–∫—Ç–æ—Ä -->
            <div id="page-editor" class="page-content" style="display: none;">
                <div class="editor-container">
                    <div class="code-editor">
                        <div class="editor-header">
                            <div class="editor-tabs">
                                <div class="editor-tab active" data-file="index.html">index.html</div>
                                <div class="editor-tab" data-file="style.css">style.css</div>
                                <div class="editor-tab" data-file="goose.json">goose.json</div>
                            </div>
                            <button class="btn" style="padding: 8px 15px;" onclick="saveCurrentFile()">
                                üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                        </div>
                        <textarea class="code-input" id="code-editor" spellcheck="false"></textarea>
                    </div>
                    
                    <div class="preview-frame">
                        <div class="editor-header">
                            <div>üëÅÔ∏è –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</div>
                            <button class="btn" style="padding: 8px 15px;" onclick="refreshPreview()">
                                üîÑ –û–±–Ω–æ–≤–∏—Ç—å
                            </button>
                        </div>
                        <iframe id="preview-frame"></iframe>
                    </div>
                </div>
                
                <div style="margin-top: 20px; display: flex; gap: 10px;">
                    <button class="btn" onclick="openFileManager()">
                        üìÅ –§–∞–π–ª—ã
                    </button>
                    <button class="btn" onclick="publishSite()" id="publish-btn">
                        üåê –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å
                    </button>
                    <button class="btn" style="background: #e9ecef; color: #666;" onclick="switchPage('dashboard')">
                        ‚Üê –ù–∞–∑–∞–¥ –∫ —Å–∞–π—Ç–∞–º
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ -->
    <div class="notification" id="notification">
        <div style="font-weight: bold; margin-bottom: 5px;" id="notification-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ</div>
        <div id="notification-message">–°–æ–æ–±—â–µ–Ω–∏–µ</div>
    </div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
        const CONFIG = {
            supabaseUrl: 'https://uvhtwedzxejuwiaofavk.supabase.co',
            supabaseKey: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2aHR3ZWR6eGVqdXdpYW9mYXZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNDA3MjgsImV4cCI6MjA4MDcxNjcyOH0.9l4Xlj4CwRJS9Q3cT-pK9udW25-ptewrozUDbLgTjUM',
            githubRepo: 'Goose-Online/goose-sites',
            githubToken: '', // –ë—É–¥–µ—Ç –∑–∞–ø–æ–ª–Ω–µ–Ω–æ –ø–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
            storageLimit: 50, // –ú–ë
            apiUrl: 'https://api.github.com'
        };
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
        let supabaseClient = null;
        let currentUser = null;
        let currentSite = null;
        let currentFile = 'index.html';
        let userSites = [];
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        async function init() {
            try {
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
                supabaseClient = window.supabase.createClient(CONFIG.supabaseUrl, CONFIG.supabaseKey);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
                const { data: { session } } = await supabaseClient.auth.getSession();
                if (!session) {
                    window.location.href = '/login.html';
                    return;
                }
                
                currentUser = session.user;
                updateUserInfo();
                loadUserSites();
                
                // –ü–æ–ª—É—á–∞–µ–º GitHub —Ç–æ–∫–µ–Ω (–µ—Å–ª–∏ –µ—Å—Ç—å)
                const { data } = await supabaseClient.auth.getUser();
                CONFIG.githubToken = data.user?.user_metadata?.github_token || '';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
        function updateUserInfo() {
            if (!currentUser) return;
            
            const avatar = document.getElementById('user-avatar');
            const name = document.getElementById('user-name');
            const storage = document.getElementById('user-storage');
            
            avatar.textContent = currentUser.email[0].toUpperCase();
            name.textContent = currentUser.email.split('@')[0];
            
            // –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω–æ–µ –º–µ—Å—Ç–æ
            let used = 0;
            userSites.forEach(site => {
                used += site.usedStorage || 0;
            });
            
            storage.textContent = `${used.toFixed(1)}/${CONFIG.storageLimit} –ú–ë`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä
            const percent = Math.min((used / CONFIG.storageLimit) * 100, 100);
            document.querySelectorAll('.storage-used').forEach(bar => {
                bar.style.width = `${percent}%`;
            });
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–∞–π—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        async function loadUserSites() {
            try {
                // –ü–æ–ª—É—á–∞–µ–º —Å–∞–π—Ç—ã –∏–∑ Supabase
                const { data: sites, error } = await supabaseClient
                    .from('sites')
                    .select('*')
                    .eq('user_id', currentUser.id)
                    .eq('hosting_type', 'selfhosted');
                
                if (error) throw error;
                
                userSites = sites || [];
                renderSitesList();
                updateUserInfo();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∞–π—Ç–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–ø–∏—Å–æ–∫ —Å–∞–π—Ç–æ–≤');
            }
        }
        
        // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–∞–π—Ç–æ–≤
        function renderSitesList() {
            const container = document.getElementById('sites-list');
            
            if (userSites.length === 0) {
                container.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 40px;">
                        <div style="font-size: 48px; margin-bottom: 20px;">ü¶¢</div>
                        <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç —Å–∞–π—Ç–æ–≤</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ—ë –ø–µ—Ä–≤–æ–µ –≥–Ω–µ–∑–¥–æ –≤ –ì—É—Å–∏–Ω–æ–º –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ!</p>
                        <button class="btn" onclick="switchPage('create')" style="margin-top: 20px;">
                            –°–æ–∑–¥–∞—Ç—å —Å–∞–π—Ç
                        </button>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = userSites.map(site => `
                <div class="site-card" onclick="editSite('${site.id}')">
                    <div class="site-card-header">
                        <div class="site-name">${site.title}</div>
                        <div class="site-status">${site.status === 'published' ? 'üåê –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω' : 'üìù –ß–µ—Ä–Ω–æ–≤–∏–∫'}</div>
                    </div>
                    <div class="site-meta">
                        ${site.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}
                    </div>
                    <div class="site-meta">
                        –°–æ–∑–¥–∞–Ω: ${new Date(site.created_at).toLocaleDateString()}
                    </div>
                    <div style="margin: 10px 0;">
                        <div style="font-size: 12px; color: #666; margin-bottom: 5px;">
                            üì¶ ${(site.usedStorage || 0).toFixed(1)}/${site.storageLimit || 50} –ú–ë
                        </div>
                        <div class="storage-bar">
                            <div class="storage-used" style="width: ${Math.min(((site.usedStorage || 0) / (site.storageLimit || 50)) * 100, 100)}%"></div>
                        </div>
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 15px;">
                        <button class="btn" style="padding: 5px 10px; font-size: 12px;" 
                                onclick="event.stopPropagation(); openSite('${site.url}')">
                            üîó –û—Ç–∫—Ä—ã—Ç—å
                        </button>
                        <button class="btn" style="padding: 5px 10px; font-size: 12px; background: #e9ecef; color: #666;"
                                onclick="event.stopPropagation(); deleteSite('${site.id}')">
                            üóëÔ∏è –£–¥–∞–ª–∏—Ç—å
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Å–∞–π—Ç–∞
        async function createSite() {
            const name = document.getElementById('site-name').value.trim();
            const description = document.getElementById('site-description').value.trim();
            const template = document.getElementById('site-template').value;
            const biom = document.getElementById('site-biom').value;
            
            if (!name) {
                showNotification('–û—à–∏–±–∫–∞', '–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞');
                return;
            }
            
            if (!CONFIG.githubToken) {
                showNotification('–û—à–∏–±–∫–∞', '–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥–∫–ª—é—á–∏—Ç–µ –∞–∫–∫–∞—É–Ω—Ç GitHub');
                return;
            }
            
            try {
                showNotification('–°–æ–∑–¥–∞–Ω–∏–µ', '–°–æ–∑–¥–∞—ë–º –≤–∞—à —Å–∞–π—Ç...');
                
                // 1. –°–æ–∑–¥–∞—ë–º –∑–∞–ø–∏—Å—å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                const { data: site, error: dbError } = await supabaseClient
                    .from('sites')
                    .insert([{
                        url: `https://${CONFIG.githubRepo.split('/')[0]}.github.io/${CONFIG.githubRepo.split('/')[1]}/sites/${currentUser.id}/${name.toLowerCase().replace(/\s+/g, '-')}/`,
                        title: name,
                        description: description,
                        category: biom,
                        user_id: currentUser.id,
                        status: 'draft',
                        hosting_type: 'selfhosted',
                        storage_limit: CONFIG.storageLimit,
                        used_storage: 0
                    }])
                    .select()
                    .single();
                
                if (dbError) throw dbError;
                
                // 2. –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –Ω–∞ GitHub
                const folderName = `${currentUser.id}/${name.toLowerCase().replace(/\s+/g, '-')}`;
                await createGitHubFolder(folderName);
                
                // 3. –°–æ–∑–¥–∞—ë–º —Ñ–∞–π–ª—ã —à–∞–±–ª–æ–Ω–∞
                await createTemplateFiles(folderName, template, {
                    title: name,
                    description: description,
                    biom: biom,
                    author: currentUser.email
                });
                
                // 4. –û–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ —Å–∞–π—Ç–æ–≤
                await loadUserSites();
                
                showNotification('–£—Å–ø–µ—Ö', '–°–∞–π—Ç —Å–æ–∑–¥–∞–Ω! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å.');
                setTimeout(() => editSite(site.id), 1000);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Å–∞–π—Ç–∞:', error);
                showNotification('–û—à–∏–±–∫–∞', error.message || '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å —Å–∞–π—Ç');
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –Ω–∞ GitHub
        async function createGitHubFolder(folderName) {
            const response = await fetch(`${CONFIG.apiUrl}/repos/${CONFIG.githubRepo}/contents/sites/${folderName}/.keep`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${CONFIG.githubToken}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `Create site folder: ${folderName}`,
                    content: btoa('') // –ü—É—Å—Ç–æ–π —Ñ–∞–π–ª
                })
            });
            
            if (!response.ok) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –ø–∞–ø–∫—É –Ω–∞ GitHub');
            }
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–æ–≤ —à–∞–±–ª–æ–Ω–∞
        async function createTemplateFiles(folderName, template, data) {
            const templates = {
                'blank': {
                    'index.html': `<!DOCTYPE html>
<html lang="ru" data-goosenet-site="true">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${data.title} | –ì—É—Å–∏–Ω—ã–π –ò–Ω—Ç–µ—Ä–Ω–µ—Ç</title>
    <script src="https://–≤–∞—à-–≤–∏–¥–∂–µ—Ç.vercel.app/widget.js"><\/script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .goose-header { text-align: center; margin-bottom: 40px; }
        h1 { color: #8b4513; }
    </style>
</head>
<body>
    <header class="goose-header">
        <h1>${data.title}</h1>
        <p>${data.description}</p>
    </header>
    <main>
        <p>–≠—Ç–æ –≤–∞—à –Ω–æ–≤—ã–π —Å–∞–π—Ç –≤ –ì—É—Å–∏–Ω–æ–º –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–µ! –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —Ñ–∞–π–ª, —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–Ω—Ç.</p>
    </main>
    <footer>
        <p>–ß–∞—Å—Ç—å ü¶¢ –ì—É—Å–∏–Ω–æ–≥–æ –ò–Ω—Ç–µ—Ä–Ω–µ—Ç–∞</p>
    </footer>
</body>
</html>`,
                    'goose.json': JSON.stringify({
                        owner: currentUser.id,
                        title: data.title,
                        description: data.description,
                        biom: data.biom,
                        created: new Date().toISOString().split('T')[0],
                        storageLimit: CONFIG.storageLimit,
                        usedStorage: 0,
                        visibility: 'public'
                    }, null, 2)
                },
                'blog': {
                    'index.html': `<!DOCTYPE html>
<html lang="ru" data-goosenet-site="true">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${data.title} | –ë–ª–æ–≥</title>
    <script src="https://–≤–∞—à-–≤–∏–¥–∂–µ—Ç.vercel.app/widget.js"><\/script>
    <style>
        body { font-family: 'Georgia', serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .post { margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid #eee; }
        .post-title { color: #8b4513; }
        .post-date { color: #666; font-size: 0.9em; }
    </style>
</head>
<body>
    <header>
        <h1>${data.title}</h1>
        <p>${data.description}</p>
    </header>
    <main>
        <div class="post">
            <h2 class="post-title">–ü–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å</h2>
            <div class="post-date">${new Date().toLocaleDateString()}</div>
            <p>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –º–æ–π –±–ª–æ–≥! –≠—Ç–æ –ø–µ—Ä–≤–∞—è –∑–∞–ø–∏—Å—å. –†–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ—ë –∏–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ –Ω–æ–≤—ã–µ.</p>
        </div>
    </main>
</body>
</html>`,
                    'goose.json': JSON.stringify({
                        owner: currentUser.id,
                        title: data.title,
                        description: data.description,
                        biom: data.biom,
                        created: new Date().toISOString().split('T')[0],
                        storageLimit: CONFIG.storageLimit,
                        usedStorage: 0,
                        visibility: 'public',
                        type: 'blog'
                    }, null, 2)
                }
            };
            
            const files = templates[template] || templates.blank;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞–∂–¥—ã–π —Ñ–∞–π–ª
            for (const [filename, content] of Object.entries(files)) {
                await fetch(`${CONFIG.apiUrl}/repos/${CONFIG.githubRepo}/contents/sites/${folderName}/${filename}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${CONFIG.githubToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Create ${filename} for ${data.title}`,
                        content: btoa(content)
                    })
                });
            }
        }
        
        // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞
        async function editSite(siteId) {
            currentSite = userSites.find(s => s.id === siteId);
            if (!currentSite) return;
            
            switchPage('editor');
            document.getElementById('page-title').textContent = `–†–µ–¥–∞–∫—Ç–æ—Ä: ${currentSite.title}`;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º —Ñ–∞–π–ª—ã —Å–∞–π—Ç–∞
            await loadSiteFiles();
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ —Å–∞–π—Ç–∞
        async function loadSiteFiles() {
            if (!currentSite || !CONFIG.githubToken) return;
            
            try {
                // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø—É—Ç—å –∏–∑ URL —Å–∞–π—Ç–∞
                const pathMatch = currentSite.url.match(/sites\/(.+)\/$/);
                if (!pathMatch) {
                    showNotification('–û—à–∏–±–∫–∞', '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç URL —Å–∞–π—Ç–∞');
                    return;
                }
                
                const sitePath = pathMatch[1];
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                const response = await fetch(
                    `${CONFIG.apiUrl}/repos/${CONFIG.githubRepo}/contents/sites/${sitePath}`,
                    {
                        headers: {
                            'Authorization': `token ${CONFIG.githubToken}`
                        }
                    }
                );
                
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã');
                
                const files = await response.json();
                
                // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –ø–µ—Ä–≤—ã–π —Ñ–∞–π–ª
                if (files.length > 0) {
                    const firstFile = files.find(f => f.name === 'index.html') || files[0];
                    await loadFileContent(firstFile.path, firstFile.name);
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤:', error);
                showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª—ã —Å–∞–π—Ç–∞');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Ñ–∞–π–ª–∞
        async function loadFileContent(filePath, fileName) {
            try {
                const response = await fetch(
                    `${CONFIG.apiUrl}/repos/${CONFIG.githubRepo}/contents/${filePath}`,
                    {
                        headers: {
                            'Authorization': `token ${CONFIG.githubToken}`
                        }
                    }
                );
                
                if (!response.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª');
                
                const file = await response.json();
                const content = atob(file.content);
                
                // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É
                document.querySelectorAll('.editor-tab').forEach(tab => {
                    tab.classList.remove('active');
                    if (tab.dataset.file === fileName) {
                        tab.classList.add('active');
                    }
                });
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä
                document.getElementById('code-editor').value = content;
                currentFile = fileName;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –¥–ª—è HTML —Ñ–∞–π–ª–æ–≤
                if (fileName.endsWith('.html')) {
                    const previewFrame = document.getElementById('preview-frame');
                    previewFrame.srcdoc = content;
                }
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞:', error);
                showNotification('–û—à–∏–±–∫–∞', `–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª ${fileName}`);
            }
        }
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞
        async function saveCurrentFile() {
            if (!currentSite || !currentFile || !CONFIG.githubToken) return;
            
            try {
                const content = document.getElementById('code-editor').value;
                const sitePath = currentSite.url.match(/sites\/(.+)\/$/)[1];
                const filePath = `sites/${sitePath}/${currentFile}`;
                
                // –ü–æ–ª—É—á–∞–µ–º SHA —Ç–µ–∫—É—â–µ–≥–æ —Ñ–∞–π–ª–∞ (–¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
                const getResponse = await fetch(
                    `${CONFIG.apiUrl}/repos/${CONFIG.githubRepo}/contents/${filePath}`,
                    {
                        headers: {
                            'Authorization': `token ${CONFIG.githubToken}`
                        }
                    }
                );
                
                let sha = '';
                if (getResponse.ok) {
                    const fileData = await getResponse.json();
                    sha = fileData.sha;
                }
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ñ–∞–π–ª
                const saveResponse = await fetch(
                    `${CONFIG.apiUrl}/repos/${CONFIG.githubRepo}/contents/${filePath}`,
                    {
                        method: 'PUT',
                        headers: {
                            'Authorization': `token ${CONFIG.githubToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            message: `Update ${currentFile}`,
                            content: btoa(content),
                            sha: sha || undefined
                        })
                    }
                );
                
                if (!saveResponse.ok) throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª');
                
                showNotification('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ', '–§–∞–π–ª —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω—ë–Ω');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä
                if (currentFile.endsWith('.html')) {
                    refreshPreview();
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
                await updateStorageStats();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
                showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ñ–∞–π–ª');
            }
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
        async function updateStorageStats() {
            if (!currentSite || !CONFIG.githubToken) return;
            
            try {
                const sitePath = currentSite.url.match(/sites\/(.+)\/$/)[1];
                
                // –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤
                const response = await fetch(
                    `${CONFIG.apiUrl}/repos/${CONFIG.githubRepo}/contents/sites/${sitePath}?recursive=1`,
                    {
                        headers: {
                            'Authorization': `token ${CONFIG.githubToken}`
                        }
                    }
                );
                
                if (!response.ok) return;
                
                const files = await response.json();
                let totalSize = 0;
                
                // –°—á–∏—Ç–∞–µ–º —Ä–∞–∑–º–µ—Ä –≤—Å–µ—Ö —Ñ–∞–π–ª–æ–≤
                files.forEach(file => {
                    if (file.type === 'file') {
                        totalSize += file.size || 0;
                    }
                });
                
                // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –±–∞–π—Ç—ã –≤ –ú–ë
                const usedStorageMB = totalSize / 1024 / 1024;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                await supabaseClient
                    .from('sites')
                    .update({ used_storage: usedStorageMB })
                    .eq('id', currentSite.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                currentSite.used_storage = usedStorageMB;
                updateUserInfo();
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', error);
            }
        }
        
        // –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–∞–π—Ç–∞
        async function publishSite() {
            if (!currentSite) return;
            
            try {
                showNotification('–ü—É–±–ª–∏–∫–∞—Ü–∏—è', '–ü—É–±–ª–∏–∫—É–µ–º –≤–∞—à —Å–∞–π—Ç...');
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
                await supabaseClient
                    .from('sites')
                    .update({ 
                        status: 'published',
                        published_at: new Date().toISOString()
                    })
                    .eq('id', currentSite.id);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
                currentSite.status = 'published';
                
                showNotification('–£—Å–ø–µ—Ö', '–°–∞–π—Ç –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω!');
                document.getElementById('publish-btn').textContent = '‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ';
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏:', error);
                showNotification('–û—à–∏–±–∫–∞', '–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Å–∞–π—Ç');
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º–∏
        function switchPage(page) {
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
            document.querySelectorAll('.page-content').forEach(el => {
                el.style.display = 'none';
            });
            
            // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —É –≤—Å–µ—Ö –ø—É–Ω–∫—Ç–æ–≤ –º–µ–Ω—é
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –Ω—É–∂–Ω—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É
            const pageElement = document.getElementById(`page-${page}`);
            if (pageElement) {
                pageElement.style.display = 'block';
            }
            
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –ø—É–Ω–∫—Ç –º–µ–Ω—é
            const menuItem = document.querySelector(`.nav-item[data-page="${page}"]`);
            if (menuItem) {
                menuItem.classList.add('active');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫
            const titles = {
                'dashboard': '–ú–æ–∏ —Å–∞–π—Ç—ã',
                'create': '–°–æ–∑–¥–∞—Ç—å —Å–∞–π—Ç',
                'templates': '–®–∞–±–ª–æ–Ω—ã',
                'files': '–§–∞–π–ª–æ–≤—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä',
                'editor': `–†–µ–¥–∞–∫—Ç–æ—Ä: ${currentSite?.title || ''}`
            };
            
            document.getElementById('page-title').textContent = titles[page] || page;
        }
        
        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function showNotification(title, message) {
            document.getElementById('notification-title').textContent = title;
            document.getElementById('notification-message').textContent = message;
            const notification = document.getElementById('notification');
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        function refreshPreview() {
            const content = document.getElementById('code-editor').value;
            const previewFrame = document.getElementById('preview-frame');
            previewFrame.srcdoc = content;
        }
        
        function openSite(url) {
            window.open(url, '_blank');
        }
        
        function openGitHubRepo() {
            window.open(`https://github.com/${CONFIG.githubRepo}`, '_blank');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', init);
        
        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                const page = item.dataset.page;
                if (page !== 'editor') { // –†–µ–¥–∞–∫—Ç–æ—Ä –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
                    switchPage(page);
                }
            });
        });
        
        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞
        document.querySelectorAll('.editor-tab').forEach(tab => {
            tab.addEventListener('click', async () => {
                if (!currentSite) return;
                
                const fileName = tab.dataset.file;
                const sitePath = currentSite.url.match(/sites\/(.+)\/$/)[1];
                const filePath = `sites/${sitePath}/${fileName}`;
                
                await loadFileContent(filePath, fileName);
            });
        });
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫
        window.createNewSite = () => switchPage('create');
        window.openFileManager = () => switchPage('files');
        
    </script>
</body>
</html>
