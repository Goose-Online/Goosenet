<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—É—Å–∏–Ω—ã–π –ò–Ω—Ç–µ—Ä–Ω–µ—Ç - –•–∞–±</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .hidden { display: none; }
        .site-card { border: 1px solid #ccc; padding: 15px; margin: 10px 0; border-radius: 8px; }
        .biom { display: inline-block; padding: 5px 10px; border-radius: 15px; margin-right: 10px; font-size: 12px; }
        .biom-swamp { background: #c6efcd; }
        .biom-tech { background: #c6d9f1; }
        .biom-art { background: #f1c6e7; }
    </style>
</head>
<body>
    <h1>ü¶¢ –ì—É—Å–∏–Ω—ã–π –ò–Ω—Ç–µ—Ä–Ω–µ—Ç</h1>
    
    <div id="auth-section">
        <div id="logged-out">
            <h3>–í—Ö–æ–¥/–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</h3>
            <input type="email" id="email" placeholder="email">
            <input type="password" id="password" placeholder="–ø–∞—Ä–æ–ª—å">
            <button onclick="login()">–í–æ–π—Ç–∏</button>
            <button onclick="signup()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
        </div>
        <div id="logged-in" class="hidden">
            <h3>–ü—Ä–∏–≤–µ—Ç, <span id="user-email"></span>!</h3>
            <button onclick="logout()">–í—ã–π—Ç–∏</button>
            
            <h4>–î–æ–±–∞–≤–∏—Ç—å —Å–≤–æ–π —Å–∞–π—Ç:</h4>
            <input type="text" id="site-url" placeholder="URL –≤–∞—à–µ–≥–æ —Å–∞–π—Ç–∞ (—Å http://)">
            <input type="text" id="site-title" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ —Å–∞–π—Ç–∞">
            <select id="site-biom">
                <option value="swamp">ü¶¢ –ë–æ–ª–æ—Ç–æ (–±–ª–æ–≥–∏, —Ñ–∏–ª–æ—Å–æ—Ñ–∏—è)</option>
                <option value="tech">üåÄ –¢–µ—Ö–Ω–æ–±–æ–ª–æ—Ç–æ (–∫–æ–¥, —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏)</option>
                <option value="art">üé® –õ—É–≥–∞ –∏—Å–∫—É—Å—Å—Ç–≤–∞ (–∞—Ä—Ç, –º—É–∑—ã–∫–∞)</option>
            </select>
            <button onclick="addSite()">–î–æ–±–∞–≤–∏—Ç—å –≤ –ì—É—Å–Ω–µ—Ç</button>
        </div>
    </div>
    
    <h2>–ö–∞—Ä—Ç–∞ —É–≥–æ–¥–∏–π</h2>
    <div id="sites-list"></div>
    
    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase (–í–°–¢–ê–í–¨–¢–ï –°–í–û–ò –ö–õ–Æ–ß–ò!)
        const supabaseUrl = 'https://uvhtwedzxejuwiaofavk.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InV2aHR3ZWR6eGVqdXdpYW9mYXZrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjUxNDA3MjgsImV4cCI6MjA4MDcxNjcyOH0.9l4Xlj4CwRJS9Q3cT-pK9udW25-ptewrozUDbLgTjUM';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            if (user) {
                document.getElementById('logged-out').classList.add('hidden');
                document.getElementById('logged-in').classList.remove('hidden');
                document.getElementById('user-email').textContent = user.email;
                loadSites();
            }
        }
        
        // –§—É–Ω–∫—Ü–∏–∏ –≤—Ö–æ–¥–∞/—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
        async function login() {
        async function login() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    
    // –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—Ö–æ–¥–∞
    const redirectTo = window.location.origin + '/auth.html';
    
    const { error } = await supabase.auth.signInWithPassword({ 
        email, 
        password 
    }, {
        redirectTo: redirectTo  // –î–æ–±–∞–≤–ª—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
    });
    
    if (error) alert('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: ' + error.message);
}

async function signup() {
    const email = document.getElementById('email').value;
    const password = document.getElementById('password').value;
    
    // –†–µ–¥–∏—Ä–µ–∫—Ç –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ—á—Ç—ã
    const redirectTo = window.location.origin + '/auth.html';
    
    const { error } = await supabase.auth.signUp({ 
        email, 
        password 
    }, {
        redirectTo: redirectTo  // –ö–ª—é—á–µ–≤–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä!
    });
    
    if (error) {
        alert('–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏: ' + error.message);
    } else {
        alert('–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞! –ü—Ä–æ–≤–µ—Ä—å—Ç–µ email –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.');
    }
}
        
        async function logout() {
            await supabase.auth.signOut();
            location.reload();
        }
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ —Å–∞–π—Ç–æ–≤
        async function loadSites() {
            const { data: sites, error } = await supabase
                .from('sites')
                .select('*')
                .eq('verified', true);
            
            if (error) {
                console.error(error);
                return;
            }
            
            const container = document.getElementById('sites-list');
            container.innerHTML = '<p>–ó–∞–≥—Ä—É–∂–∞–µ–º —É–≥–æ–¥—å—è...</p>';
            
            if (sites.length === 0) {
                container.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç —Å–∞–π—Ç–æ–≤. –ë—É–¥—å –ø–µ—Ä–≤—ã–º!</p>';
                return;
            }
            
            container.innerHTML = sites.map(site => `
                <div class="site-card">
                    <span class="biom biom-${site.category}">${getBiomName(site.category)}</span>
                    <h3><a href="${site.url}" target="_blank">${site.title}</a></h3>
                    <p>${site.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</p>
                </div>
            `).join('');
        }
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∞–π—Ç–∞
        async function addSite() {
            const url = document.getElementById('site-url').value;
            const title = document.getElementById('site-title').value;
            const biom = document.getElementById('site-biom').value;
            
            const { data: { user } } = await supabase.auth.getUser();
            if (!user) return alert('–°–Ω–∞—á–∞–ª–∞ –≤–æ–π–¥–∏—Ç–µ!');
            
            const { error } = await supabase
                .from('sites')
                .insert([{ 
                    url, 
                    title, 
                    category: biom,
                    user_id: user.id,
                    verified: true // –ù–∞ —Å—Ç–∞—Ä—Ç–µ –≤—Å–µ–º –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
                }]);
            
            if (error) {
                alert('–û—à–∏–±–∫–∞: ' + error.message);
            } else {
                alert('–°–∞–π—Ç –¥–æ–±–∞–≤–ª–µ–Ω!');
                loadSites();
            }
        }
        
        function getBiomName(code) {
            const map = { swamp: 'ü¶¢ –ë–æ–ª–æ—Ç–æ', tech: 'üåÄ –¢–µ—Ö–Ω–æ', art: 'üé® –ò—Å–∫—É—Å—Å—Ç–≤–æ' };
            return map[code] || code;
        }
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        checkAuth();
    </script>
</body>
</html>
